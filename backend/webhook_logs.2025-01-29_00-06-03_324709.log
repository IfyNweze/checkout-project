2025-01-29 00:25:36.263 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 00:28:03.970 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 00:28:03.978 | INFO     | app.webhook_listener:handle_webhook:59 - Webhook Data: {'id': 'evt_test123', 'type': 'payment_approved', 'data': {'id': 'pay_test123', 'amount': 1000, 'currency': 'USD', 'reference': 'order_test', 'customer': {'email': 'test@example.com'}, 'processed_on': '2024-01-28T12:00:00Z', 'response_code': '00', 'response_summary': 'Approved'}}
2025-01-29 00:28:04.556 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: AttributeError("'APIResponse[TypeVar]' object has no attribute 'get'")
2025-01-29 00:28:04.556 | SUCCESS  | app.webhook_listener:handle_webhook:79 - ✅ Payment pay_test123 stored successfully
2025-01-29 00:32:12.851 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 00:32:12.857 | INFO     | app.webhook_listener:handle_webhook:59 - Webhook Data: {'id': 'evt_test123', 'type': 'payment_approved', 'data': {'id': 'pay_test123', 'amount': 1000, 'currency': 'USD', 'reference': 'order_test', 'customer': {'email': 'test@example.com'}, 'processed_on': '2024-01-28T12:00:00Z', 'response_code': '00', 'response_summary': 'Approved'}}
2025-01-29 00:32:13.349 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: Error 23505:
Message: duplicate key value violates unique constraint "checkout_payments_pkey"
Details: Key (payment_id)=(pay_test123) already exists.
2025-01-29 00:32:13.350 | SUCCESS  | app.webhook_listener:handle_webhook:79 - ✅ Payment pay_test123 stored successfully
2025-01-29 00:40:42.805 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 00:40:42.811 | INFO     | app.webhook_listener:handle_webhook:59 - Webhook Data: {'id': 'evt_test123', 'type': 'payment_approved', 'data': {'id': 'pay_test123', 'amount': 1000, 'currency': 'USD'}}
2025-01-29 00:40:43.289 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: Error 22007:
Message: invalid input syntax for type timestamp: "unknown_timestamp"
2025-01-29 00:40:43.289 | SUCCESS  | app.webhook_listener:handle_webhook:79 - ✅ Payment pay_test123 stored successfully
2025-01-29 01:22:04.766 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 01:22:04.777 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_test123', 'type': 'payment_approved', 'data': {'id': 'pay_test123', 'amount': 1000, 'currency': 'USD', 'reference': 'order_test'}}
2025-01-29 01:22:05.310 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: Error 22007:
Message: invalid input syntax for type timestamp: "unknown_timestamp"
2025-01-29 01:22:05.310 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_test123 stored successfully
2025-01-29 01:30:36.068 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 01:30:36.072 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_jzieik3wb66evpqwpwa6ab6y5e', 'type': 'payment_approved', 'version': '1.0.12', 'created_on': '2025-01-29T01:30:35.8796571Z', 'data': {'id': 'pay_m7ex7prvqarubmuci5qpf7pwni', 'action_id': 'act_m7ex7prvqarubmuci5qpf7pwni', 'reference': 'ORD-5023-4B22', 'amount': 5605, 'auth_code': '075867', 'currency': 'GBP', 'metadata': {'coupon_code': 'NY2018', 'partner_id': 123456}, 'payment_type': 'Regular', 'processed_on': '2021-12-14T15:31:57.0052526Z', 'processing': {'acquirer_transaction_id': '8137679534', 'retrieval_reference_number': '000007895254'}, 'response_code': '10000', 'response_summary': 'Approved', 'scheme_id': '638084745594565', 'source': {'id': 'src_m7ex7prvqarubmuci5qpf7pwni', 'type': 'card', 'billing_address': {'line1': 'test road', 'line2': 'test road 2', 'town_city': 'test city', 'zip': 'abc 123', 'state': 'test state', 'country': 'GB'}, 'expiry_month': 6, 'expiry_year': 2023, 'scheme': 'VISA', 'last_4': '1234', 'fingerprint': '71580b426f1d190d29087ff265d8f48df1ad34ede41c27cbff9d23c1a14d1114', 'bin': '123456', 'card_type': 'DEBIT', 'card_category': 'CONSUMER', 'issuer': 'BANK PLC', 'issuer_country': 'GB', 'product_id': 'F', 'product_type': 'Visa Classic', 'avs_check': 'F', 'cvv_check': ''}, 'customer': {'id': 'cus_m7ex7prvqarubmuci5qpf7pwni', 'email': 'test@test.com'}, 'risk': {'flagged': False}, 'balances': {'total_authorized': 5605, 'total_voided': 0, 'available_to_void': 5605, 'total_captured': 0, 'available_to_capture': 5605, 'total_refunded': 0, 'available_to_refund': 0}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_jzieik3wb66evpqwpwa6ab6y5e'}}}
2025-01-29 01:30:36.448 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: AttributeError("'APIResponse[TypeVar]' object has no attribute 'get'")
2025-01-29 01:30:36.448 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_m7ex7prvqarubmuci5qpf7pwni stored successfully
2025-01-29 01:38:06.852 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 01:38:06.860 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_inya2gemfd4ejptskyovk6hc5y', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T01:38:04.322Z', 'data': {'id': 'pay_eytiudozlpdudabga3aki7x2na', 'action_id': 'act_b3fts76nrv6edgxyqhzaova6ly', 'amount': 3000, 'processed_on': '2025-01-29T01:38:04.3088486Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 3000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 3000}, 'metadata': {'cko_payment_session_id': 'ps_2sHZo8oPukYJDwPCOuA9SUfNHoV'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '428454161231871571881', 'acquirer_reference_number': '56832459229423207809567'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_inya2gemfd4ejptskyovk6hc5y'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_eytiudozlpdudabga3aki7x2na'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na/refunds'}}}
2025-01-29 01:38:07.210 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: AttributeError("'APIResponse[TypeVar]' object has no attribute 'get'")
2025-01-29 01:38:07.210 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_eytiudozlpdudabga3aki7x2na stored successfully
2025-01-29 01:38:08.428 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 01:38:08.429 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_ygzfj7665v7undubaealku323m', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T01:38:04.234Z', 'data': {'id': 'pay_eytiudozlpdudabga3aki7x2na', 'action_id': 'act_vqkaitr7rrhercgoz6437qwvye', 'amount': 3000, 'auth_code': '124203', 'currency': 'GBP', 'customer': {'id': 'cus_4tmdork4zfre5aehuukm2eahvu', 'email': 'test.customer@example.com'}, 'metadata': {'cko_payment_session_id': 'ps_2sHZo8oPukYJDwPCOuA9SUfNHoV'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T01:38:04.2264827Z', 'processing': {'acquirer_transaction_id': '090817424416027938965', 'retrieval_reference_number': '142424391138', 'aft': 'False', 'scheme': 'MASTERCARD'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '02', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': '5970a767-b9da-4379-bae1-cbd667aa8990', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '340541829445320', 'source': {'type': 'card', 'billing_address': {'line1': '123 High St.', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'SW1A 1AA', 'country': 'GB'}, 'expiry_month': 12, 'expiry_year': 2025, 'name': 'Tester5', 'scheme': 'MASTERCARD', 'last_4': '6417', 'fingerprint': 'A4BC8F58E3B4A96144A7C40535DF407FE1D05E5C0E69EB11D6C31DDF85D90A84', 'bin': '558868', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'PSA PAYMENT SERVICES AUSTRIA GMBH', 'issuer_country': 'CN', 'product_id': 'MDS', 'product_type': 'Debit MasterCard® Card', 'avs_check': 'S', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 3000, 'total_captured': 0, 'available_to_capture': 3000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_ygzfj7665v7undubaealku323m'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_eytiudozlpdudabga3aki7x2na'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_eytiudozlpdudabga3aki7x2na/voids'}}}
2025-01-29 01:38:08.556 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: Error 23505:
Message: duplicate key value violates unique constraint "checkout_payments_pkey"
Details: Key (payment_id)=(pay_eytiudozlpdudabga3aki7x2na) already exists.
2025-01-29 01:38:08.557 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_eytiudozlpdudabga3aki7x2na stored successfully
2025-01-29 01:40:17.381 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 01:40:17.384 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_gpoxsid4jmjupifhzgj2vdhysq', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T01:40:15.968Z', 'data': {'id': 'pay_avu46itmpx3ulgtongichliani', 'action_id': 'act_ekyoapgo75mu3j7otokmcjlupy', 'amount': 3000, 'auth_code': '372349', 'currency': 'GBP', 'customer': {'id': 'cus_4tmdork4zfre5aehuukm2eahvu', 'email': 'test.customer@example.com'}, 'metadata': {'cko_payment_session_id': 'ps_2sHa4rZMy9x1oqOGcNzUTqwwPm0'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T01:40:15.9608873Z', 'processing': {'acquirer_transaction_id': '574027325288803009745', 'retrieval_reference_number': '453051266350', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': 'f92490d1-e422-4a2c-a195-10a3d84cfeb6', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '346552924741153', 'source': {'type': 'card', 'billing_address': {'line1': '123 High St.', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'SW1A 1AA', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'Tester11', 'scheme': 'VISA', 'last_4': '6584', 'fingerprint': 'AE32EC6480042D16252D35AE8101E09566F37885AD0383E8841125600AF97AE4', 'bin': '448504', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'BANQUE CHAABI DU MAROC', 'issuer_country': 'US', 'product_id': 'P', 'product_type': 'Visa Gold', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 3000, 'total_captured': 0, 'available_to_capture': 3000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_gpoxsid4jmjupifhzgj2vdhysq'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_avu46itmpx3ulgtongichliani'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani/voids'}}}
2025-01-29 01:40:17.773 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: AttributeError("'APIResponse[TypeVar]' object has no attribute 'get'")
2025-01-29 01:40:17.773 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_avu46itmpx3ulgtongichliani stored successfully
2025-01-29 01:40:20.604 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 01:40:20.797 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_tku7uovjkozufajat6yiq7faly', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T01:40:16.091Z', 'data': {'id': 'pay_avu46itmpx3ulgtongichliani', 'action_id': 'act_ofqbswyfytsetgyv5waxrfrm74', 'amount': 3000, 'processed_on': '2025-01-29T01:40:16.0778181Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 3000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 3000}, 'metadata': {'cko_payment_session_id': 'ps_2sHa4rZMy9x1oqOGcNzUTqwwPm0'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '880642020094074164237', 'acquirer_reference_number': '68251743691790127215763'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_tku7uovjkozufajat6yiq7faly'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_avu46itmpx3ulgtongichliani'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_avu46itmpx3ulgtongichliani/refunds'}}}
2025-01-29 01:40:21.533 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: Error 23505:
Message: duplicate key value violates unique constraint "checkout_payments_pkey"
Details: Key (payment_id)=(pay_avu46itmpx3ulgtongichliani) already exists.
2025-01-29 01:40:21.553 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_avu46itmpx3ulgtongichliani stored successfully
2025-01-29 01:42:39.611 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 01:42:39.609 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 01:42:39.614 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_jmfafzv6hfqupkr332qdl774ua', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T01:42:36.026Z', 'data': {'id': 'pay_s4s5v7bwn4xezjvocely7mcdii', 'action_id': 'act_xk4elrcqa52e7mdrzuwwmrxfou', 'amount': 2000, 'auth_code': '343865', 'currency': 'GBP', 'customer': {'id': 'cus_4tmdork4zfre5aehuukm2eahvu', 'email': 'test.customer@example.com'}, 'metadata': {'cko_payment_session_id': 'ps_2sHaOvQFeWxyiVtavGI5tROnRyj'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T01:42:36.0188394Z', 'processing': {'acquirer_transaction_id': '356734340168987488951', 'retrieval_reference_number': '078653416839', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': 'da896348-819c-4f23-a2c0-3c1fc3a02756', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '888068454981152', 'source': {'type': 'card', 'billing_address': {'line1': '123 High St.', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'SW1A 1AA', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'Tester', 'scheme': 'VISA', 'last_4': '6584', 'fingerprint': 'AE32EC6480042D16252D35AE8101E09566F37885AD0383E8841125600AF97AE4', 'bin': '448504', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'BANQUE CHAABI DU MAROC', 'issuer_country': 'US', 'product_id': 'P', 'product_type': 'Visa Gold', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 2000, 'total_captured': 0, 'available_to_capture': 2000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_jmfafzv6hfqupkr332qdl774ua'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_s4s5v7bwn4xezjvocely7mcdii'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii/voids'}}}
2025-01-29 01:42:39.614 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_l2hoq5rh77pejbd7gwkz6lkjqm', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T01:42:36.133Z', 'data': {'id': 'pay_s4s5v7bwn4xezjvocely7mcdii', 'action_id': 'act_4ox7lfsy536ehkjowih2na7tyy', 'amount': 2000, 'processed_on': '2025-01-29T01:42:36.1224237Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 2000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 2000}, 'metadata': {'cko_payment_session_id': 'ps_2sHaOvQFeWxyiVtavGI5tROnRyj'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '986145660651593982490', 'acquirer_reference_number': '82578931761914365588664'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_l2hoq5rh77pejbd7gwkz6lkjqm'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_s4s5v7bwn4xezjvocely7mcdii'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_s4s5v7bwn4xezjvocely7mcdii/refunds'}}}
2025-01-29 01:42:40.054 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: AttributeError("'APIResponse[TypeVar]' object has no attribute 'get'")
2025-01-29 01:42:40.054 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_s4s5v7bwn4xezjvocely7mcdii stored successfully
2025-01-29 01:42:40.065 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: Error 23505:
Message: duplicate key value violates unique constraint "checkout_payments_pkey"
Details: Key (payment_id)=(pay_s4s5v7bwn4xezjvocely7mcdii) already exists.
2025-01-29 01:42:40.065 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_s4s5v7bwn4xezjvocely7mcdii stored successfully
2025-01-29 02:04:29.910 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 02:04:29.950 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_hnl6owmd6rdudernk6garfexge', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T02:04:26.282Z', 'data': {'id': 'pay_rlwvopz5ic3enisprqd4vy5bjm', 'action_id': 'act_3koqjter2yxufchchvjyt46y5y', 'amount': 8000, 'processed_on': '2025-01-29T02:04:26.2704961Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 8000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 8000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 8000}, 'metadata': {'cko_payment_session_id': 'ps_2sHcp0VTbYHvN9ymzpE9FX4hU2C'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '284345788427644757889', 'acquirer_reference_number': '38174857420798165617459'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_hnl6owmd6rdudernk6garfexge'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_rlwvopz5ic3enisprqd4vy5bjm'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm/refunds'}}}
2025-01-29 02:04:30.066 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 02:04:30.088 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_fi4viluk2pdubnxf6vidm5rwam', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T02:04:26.165Z', 'data': {'id': 'pay_rlwvopz5ic3enisprqd4vy5bjm', 'action_id': 'act_kdqzfgahtqluhotynwyfruw6zi', 'amount': 8000, 'auth_code': '374577', 'currency': 'GBP', 'customer': {'id': 'cus_4tmdork4zfre5aehuukm2eahvu', 'email': 'test.customer@example.com'}, 'metadata': {'cko_payment_session_id': 'ps_2sHcp0VTbYHvN9ymzpE9FX4hU2C'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T02:04:26.1575991Z', 'processing': {'acquirer_transaction_id': '101809886825826827619', 'retrieval_reference_number': '493413990389', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': 'ef86a06f-2d35-49dd-a18d-f1e5643b7189', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '760852577019858', 'source': {'type': 'card', 'billing_address': {'line1': '123 High St.', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'SW1A 1AA', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'Tester1', 'scheme': 'VISA', 'last_4': '6584', 'fingerprint': 'AE32EC6480042D16252D35AE8101E09566F37885AD0383E8841125600AF97AE4', 'bin': '448504', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'BANQUE CHAABI DU MAROC', 'issuer_country': 'US', 'product_id': 'P', 'product_type': 'Visa Gold', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 8000, 'total_voided': 0, 'available_to_void': 8000, 'total_captured': 0, 'available_to_capture': 8000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_fi4viluk2pdubnxf6vidm5rwam'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_rlwvopz5ic3enisprqd4vy5bjm'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_rlwvopz5ic3enisprqd4vy5bjm/voids'}}}
2025-01-29 02:04:30.501 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: RemoteProtocolError('<ConnectionTerminated error_code:1, last_stream_id:7, additional_data:None>')
2025-01-29 02:04:30.502 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: RemoteProtocolError('<ConnectionTerminated error_code:1, last_stream_id:7, additional_data:None>')
2025-01-29 02:04:30.502 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_rlwvopz5ic3enisprqd4vy5bjm stored successfully
2025-01-29 02:04:30.502 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_rlwvopz5ic3enisprqd4vy5bjm stored successfully
2025-01-29 02:07:26.068 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 02:07:26.072 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_ok5emc2gfpvenlvyvkrrjpfrfa', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T02:07:22.819Z', 'data': {'id': 'pay_7fmhgyvly5we7icsb75h7ygt4q', 'action_id': 'act_ny62bkxttgzevjvf5vl45cph2e', 'amount': 2000, 'auth_code': '927447', 'currency': 'GBP', 'customer': {'id': 'cus_4tmdork4zfre5aehuukm2eahvu', 'email': 'test.customer@example.com'}, 'metadata': {'cko_payment_session_id': 'ps_2sHdOVEUxbACUuH8uDuyZlPr8vO'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T02:07:22.8090325Z', 'processing': {'acquirer_transaction_id': '541315332652721029923', 'retrieval_reference_number': '582731236001', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': '94a39286-0c69-4d5d-9ea5-b798c73f049e', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '695189426206421', 'source': {'type': 'card', 'billing_address': {'line1': '123 High St.', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'SW1A 1AA', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'A', 'scheme': 'VISA', 'last_4': '6584', 'fingerprint': 'AE32EC6480042D16252D35AE8101E09566F37885AD0383E8841125600AF97AE4', 'bin': '448504', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'BANQUE CHAABI DU MAROC', 'issuer_country': 'US', 'product_id': 'P', 'product_type': 'Visa Gold', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 2000, 'total_captured': 0, 'available_to_capture': 2000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_ok5emc2gfpvenlvyvkrrjpfrfa'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_7fmhgyvly5we7icsb75h7ygt4q'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q/voids'}}}
2025-01-29 02:07:26.294 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 02:07:26.295 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_tojjqjz2aqkudfxm5ejvcjjpym', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T02:07:22.957Z', 'data': {'id': 'pay_7fmhgyvly5we7icsb75h7ygt4q', 'action_id': 'act_cpguxc7acwouposjrkapbcdbue', 'amount': 2000, 'processed_on': '2025-01-29T02:07:22.9428344Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 2000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 2000}, 'metadata': {'cko_payment_session_id': 'ps_2sHdOVEUxbACUuH8uDuyZlPr8vO'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '777744714563240541866', 'acquirer_reference_number': '71131220591776326926190'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_tojjqjz2aqkudfxm5ejvcjjpym'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_7fmhgyvly5we7icsb75h7ygt4q'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_7fmhgyvly5we7icsb75h7ygt4q/refunds'}}}
2025-01-29 02:07:26.585 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: Error 400:
Message: JSON could not be generated
Hint: Refer to full message for details
Details: b'<html>\r\n<head><title>400 Bad Request</title></head>\r\n<body>\r\n<center><h1>400 Bad Request</h1></center>\r\n<hr><center>cloudflare</center>\r\n</body>\r\n</html>\r\n'
2025-01-29 02:07:26.586 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_7fmhgyvly5we7icsb75h7ygt4q stored successfully
2025-01-29 02:07:26.589 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: Error 400:
Message: JSON could not be generated
Hint: Refer to full message for details
Details: b'<html>\r\n<head><title>400 Bad Request</title></head>\r\n<body>\r\n<center><h1>400 Bad Request</h1></center>\r\n<hr><center>cloudflare</center>\r\n</body>\r\n</html>\r\n'
2025-01-29 02:07:26.590 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_7fmhgyvly5we7icsb75h7ygt4q stored successfully
2025-01-29 12:32:15.092 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 12:32:15.081 | INFO     | app.webhook_listener:handle_webhook:50 - 📩 Received webhook request
2025-01-29 12:32:15.274 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_4d4ftqfa7klenpjueffbjz4uam', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T12:32:14.141Z', 'data': {'id': 'pay_e7xj7e27obtujgkgo5o5xcfnja', 'action_id': 'act_qjslggyqanwexcpg3hm4k5dzvm', 'amount': 12000, 'processed_on': '2025-01-29T12:32:14.1239637Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 12000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 12000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 12000}, 'metadata': {'cko_payment_session_id': 'ps_2sIqZT9tm794mOPAlUFrcUOxaca'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '560483872960676787829', 'acquirer_reference_number': '08120756403254400037749'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_4d4ftqfa7klenpjueffbjz4uam'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_e7xj7e27obtujgkgo5o5xcfnja'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja/refunds'}}}
2025-01-29 12:32:15.275 | INFO     | app.webhook_listener:handle_webhook:60 - Webhook Data: {'id': 'evt_5jprjrbceceuhc7wqi25faej4e', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T12:32:14.011Z', 'data': {'id': 'pay_e7xj7e27obtujgkgo5o5xcfnja', 'action_id': 'act_u57rwayc52tuxluv7atgbfyqte', 'amount': 12000, 'auth_code': '773811', 'currency': 'GBP', 'customer': {'id': 'cus_4tmdork4zfre5aehuukm2eahvu', 'email': 'test.customer@example.com'}, 'metadata': {'cko_payment_session_id': 'ps_2sIqZT9tm794mOPAlUFrcUOxaca'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T12:32:13.997164Z', 'processing': {'acquirer_transaction_id': '616244302105908894505', 'retrieval_reference_number': '307800775553', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': '8ea3a7ed-8016-43db-8976-b4f0fa9f7caf', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '901143658439959', 'source': {'type': 'card', 'billing_address': {'line1': '123 High St.', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'SW1A 1AA', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'Tester 5', 'scheme': 'VISA', 'last_4': '6584', 'fingerprint': 'AE32EC6480042D16252D35AE8101E09566F37885AD0383E8841125600AF97AE4', 'bin': '448504', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'BANQUE CHAABI DU MAROC', 'issuer_country': 'US', 'product_id': 'P', 'product_type': 'Visa Gold', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 12000, 'total_voided': 0, 'available_to_void': 12000, 'total_captured': 0, 'available_to_capture': 12000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_5jprjrbceceuhc7wqi25faej4e'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_e7xj7e27obtujgkgo5o5xcfnja'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_e7xj7e27obtujgkgo5o5xcfnja/voids'}}}
2025-01-29 12:32:17.514 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: Error 400:
Message: JSON could not be generated
Hint: Refer to full message for details
Details: b'<html>\r\n<head><title>400 Bad Request</title></head>\r\n<body>\r\n<center><h1>400 Bad Request</h1></center>\r\n<hr><center>cloudflare</center>\r\n</body>\r\n</html>\r\n'
2025-01-29 12:32:17.514 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_e7xj7e27obtujgkgo5o5xcfnja stored successfully
2025-01-29 12:32:17.564 | ERROR    | app.supabase_utils:insert_payment:82 - Error inserting payment: AttributeError("'APIResponse[TypeVar]' object has no attribute 'get'")
2025-01-29 12:32:17.564 | SUCCESS  | app.webhook_listener:handle_webhook:80 - ✅ Payment pay_e7xj7e27obtujgkgo5o5xcfnja stored successfully
2025-01-29 14:55:53.575 | INFO     | app.webhook_listener:handle_webhook:84 - 📩 Received webhook request
2025-01-29 14:55:53.578 | ERROR    | app.webhook_listener:verify_signature:43 - ⚠️ Error verifying signature: 'NoneType' object has no attribute 'encode'
2025-01-29 14:55:53.578 | WARNING  | app.webhook_listener:handle_webhook:88 - ❌ Unauthorized webhook request
2025-01-29 15:03:20.995 | INFO     | app.webhook_listener:handle_webhook:84 - 📩 Received webhook request
2025-01-29 15:03:20.997 | ERROR    | app.webhook_listener:verify_signature:43 - ⚠️ Error verifying signature: 'NoneType' object has no attribute 'encode'
2025-01-29 15:03:20.998 | WARNING  | app.webhook_listener:handle_webhook:88 - ❌ Unauthorized webhook request
2025-01-29 15:28:37.238 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 15:28:37.249 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: d632be55dae0fee48bddd4a4ca8fb6b564f483e12a8b11749c11ae4f6e57abc0
2025-01-29 15:28:37.250 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: d632be55dae0fee48bddd4a4ca8fb6b564f483e12a8b11749c11ae4f6e57abc0
2025-01-29 15:28:37.250 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 15:28:37.250 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_valid_test', 'type': 'payment_approved', 'data': {'id': 'pay_123456789', 'reference': 'ORD-2025-01-29-abc123', 'amount': 5000, 'currency': 'GBP', 'customer': {'email': 'tester5@google.com'}, 'processed_on': '2025-01-29T12:00:00Z', 'response_code': '10000', 'response_summary': 'Approved'}}
2025-01-29 15:28:37.639 | ERROR    | app.webhook_listener:handle_webhook:150 - ⚠️ Error updating payment in Supabase: {'code': 'PGRST204', 'details': None, 'hint': None, 'message': "Could not find the 'status' column of 'checkout_payments' in the schema cache"}
2025-01-29 15:31:48.588 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 15:31:48.601 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: d632be55dae0fee48bddd4a4ca8fb6b564f483e12a8b11749c11ae4f6e57abc0
2025-01-29 15:31:48.601 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: d632be55dae0fee48bddd4a4ca8fb6b564f483e12a8b11749c11ae4f6e57abc0
2025-01-29 15:31:48.601 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 15:31:48.602 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_valid_test', 'type': 'payment_approved', 'data': {'id': 'pay_123456789', 'reference': 'ORD-2025-01-29-abc123', 'amount': 5000, 'currency': 'GBP', 'customer': {'email': 'tester5@google.com'}, 'processed_on': '2025-01-29T12:00:00Z', 'response_code': '10000', 'response_summary': 'Approved'}}
2025-01-29 15:31:49.002 | ERROR    | app.webhook_listener:handle_webhook:150 - ⚠️ Error updating payment in Supabase: {'code': '42P10', 'details': None, 'hint': None, 'message': 'there is no unique or exclusion constraint matching the ON CONFLICT specification'}
2025-01-29 15:37:08.137 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 15:37:08.146 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: d632be55dae0fee48bddd4a4ca8fb6b564f483e12a8b11749c11ae4f6e57abc0
2025-01-29 15:37:08.146 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: d632be55dae0fee48bddd4a4ca8fb6b564f483e12a8b11749c11ae4f6e57abc0
2025-01-29 15:37:08.146 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 15:37:08.147 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_valid_test', 'type': 'payment_approved', 'data': {'id': 'pay_123456789', 'reference': 'ORD-2025-01-29-abc123', 'amount': 5000, 'currency': 'GBP', 'customer': {'email': 'tester5@google.com'}, 'processed_on': '2025-01-29T12:00:00Z', 'response_code': '10000', 'response_summary': 'Approved'}}
2025-01-29 15:37:08.491 | SUCCESS  | app.webhook_listener:handle_webhook:147 - ✅ Payment pay_123456789 (approved) stored successfully
2025-01-29 15:40:49.817 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 15:40:49.868 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 15:40:49.886 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: b5cf7ae22a64844da01ef1d11b86de039b8c82901a20807ea38ca3cd8c0b469b
2025-01-29 15:40:49.887 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 49c1a7477a54bc43cdf35cf53a7c2c1ae79ade344ff239c4ca1b6df7f11b350c
2025-01-29 15:40:49.887 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: b5cf7ae22a64844da01ef1d11b86de039b8c82901a20807ea38ca3cd8c0b469b
2025-01-29 15:40:49.887 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 49c1a7477a54bc43cdf35cf53a7c2c1ae79ade344ff239c4ca1b6df7f11b350c
2025-01-29 15:40:49.887 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 15:40:49.888 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 15:40:49.889 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_my65yjtu7gbelmvkccfgvxsv7y', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T15:40:46.465Z', 'data': {'id': 'pay_bdya3adh43iu7dobw5gpzurwnq', 'action_id': 'act_cs4rym4ofk3e5neyffxactyuc4', 'amount': 3000, 'processed_on': '2025-01-29T15:40:46.4529766Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 3000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 3000}, 'metadata': {'order_ref': '20250129153954-4c127eb3', 'cko_payment_session_id': 'ps_2sJEINHrJumfh2Br6ZVwn5pvZsc'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '622089336687328139130', 'acquirer_reference_number': '57049181992154462064286'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_my65yjtu7gbelmvkccfgvxsv7y'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_bdya3adh43iu7dobw5gpzurwnq'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/refunds'}}}
2025-01-29 15:40:49.889 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_ojnfcjejxveurpbyp6rotouizu', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T15:40:46.34Z', 'data': {'id': 'pay_bdya3adh43iu7dobw5gpzurwnq', 'action_id': 'act_7tate6hhd5behnrl3yxccqzzw4', 'amount': 3000, 'auth_code': '955667', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129153954-4c127eb3', 'cko_payment_session_id': 'ps_2sJEINHrJumfh2Br6ZVwn5pvZsc'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T15:40:46.3335029Z', 'processing': {'acquirer_transaction_id': '177677387034270721173', 'retrieval_reference_number': '983729995156', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': 'e568d6c9-b7ad-41ba-ac2a-f14782a03204', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '385890917895328', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'Tester5', 'scheme': 'VISA', 'last_4': '6584', 'fingerprint': 'AE32EC6480042D16252D35AE8101E09566F37885AD0383E8841125600AF97AE4', 'bin': '448504', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'BANQUE CHAABI DU MAROC', 'issuer_country': 'US', 'product_id': 'P', 'product_type': 'Visa Gold', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 3000, 'total_captured': 0, 'available_to_capture': 3000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_ojnfcjejxveurpbyp6rotouizu'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_bdya3adh43iu7dobw5gpzurwnq'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/voids'}}}
2025-01-29 15:40:49.889 | WARNING  | app.webhook_listener:handle_webhook:153 - ⚠️ Webhook received without a valid order reference.
2025-01-29 15:40:49.890 | WARNING  | app.webhook_listener:handle_webhook:153 - ⚠️ Webhook received without a valid order reference.
2025-01-29 15:44:56.768 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 15:44:56.787 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 27a8a92848468e3a6dd435c79a2750ab2f6daf6b8f3824f94f1ea38a73906235
2025-01-29 15:44:56.787 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 27a8a92848468e3a6dd435c79a2750ab2f6daf6b8f3824f94f1ea38a73906235
2025-01-29 15:44:56.787 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 15:44:56.789 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_ojnfcjejxveurpbyp6rotouizu', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T15:40:46.34Z', 'data': {'id': 'pay_bdya3adh43iu7dobw5gpzurwnq', 'action_id': 'act_7tate6hhd5behnrl3yxccqzzw4', 'amount': 3000, 'auth_code': '955667', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129153954-4c127eb3', 'cko_payment_session_id': 'ps_2sJEINHrJumfh2Br6ZVwn5pvZsc'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T15:40:46.3335029Z', 'processing': {'acquirer_transaction_id': '177677387034270721173', 'retrieval_reference_number': '983729995156', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': 'e568d6c9-b7ad-41ba-ac2a-f14782a03204', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '385890917895328', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'Tester5', 'scheme': 'VISA', 'last_4': '6584', 'fingerprint': 'AE32EC6480042D16252D35AE8101E09566F37885AD0383E8841125600AF97AE4', 'bin': '448504', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'BANQUE CHAABI DU MAROC', 'issuer_country': 'US', 'product_id': 'P', 'product_type': 'Visa Gold', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 3000, 'total_captured': 0, 'available_to_capture': 3000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_ojnfcjejxveurpbyp6rotouizu'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_bdya3adh43iu7dobw5gpzurwnq'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/captures'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/voids'}}}
2025-01-29 15:44:56.799 | WARNING  | app.webhook_listener:handle_webhook:153 - ⚠️ Webhook received without a valid order reference.
2025-01-29 15:46:39.017 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 15:46:39.118 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 0e2051b3cd890e58f009454cf0bdcf62503c3706ef2808525e870ca022436fcc
2025-01-29 15:46:39.119 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 0e2051b3cd890e58f009454cf0bdcf62503c3706ef2808525e870ca022436fcc
2025-01-29 15:46:39.119 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 15:46:39.119 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_my65yjtu7gbelmvkccfgvxsv7y', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T15:40:46.465Z', 'data': {'id': 'pay_bdya3adh43iu7dobw5gpzurwnq', 'action_id': 'act_cs4rym4ofk3e5neyffxactyuc4', 'amount': 3000, 'processed_on': '2025-01-29T15:40:46.4529766Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 3000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 3000}, 'metadata': {'order_ref': '20250129153954-4c127eb3', 'cko_payment_session_id': 'ps_2sJEINHrJumfh2Br6ZVwn5pvZsc'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '622089336687328139130', 'acquirer_reference_number': '57049181992154462064286'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_my65yjtu7gbelmvkccfgvxsv7y'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_bdya3adh43iu7dobw5gpzurwnq'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/actions'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/refunds'}}}
2025-01-29 15:46:39.649 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_bdya3adh43iu7dobw5gpzurwnq (captured) stored successfully
2025-01-29 15:47:06.084 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 15:47:06.091 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 3f17b53c4e9bbbdc5936a5cbdbcd1ef743f94f7a0206e3391b1935645b0879eb
2025-01-29 15:47:06.091 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 3f17b53c4e9bbbdc5936a5cbdbcd1ef743f94f7a0206e3391b1935645b0879eb
2025-01-29 15:47:06.091 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 15:47:06.093 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_otboyqn5dhjedggjglilu2yihm', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T15:47:03.062Z', 'data': {'id': 'pay_jdjus47cgt4udglwgpqxlktlxa', 'action_id': 'act_dzvqc73pxxweff2rcghv75oiba', 'amount': 6000, 'auth_code': '139739', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129154617-4c082054ae714bb3', 'cko_payment_session_id': 'ps_2sJF4Nuk2XpiLbaaZvZrJ8UTXOe'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T15:47:03.0549007Z', 'processing': {'acquirer_transaction_id': '534736710022389662886', 'retrieval_reference_number': '012152983087', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': '4df1a7a2-e560-4a41-8026-bf47e285c44b', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '508752656213200', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'Tester5', 'scheme': 'VISA', 'last_4': '6584', 'fingerprint': 'AE32EC6480042D16252D35AE8101E09566F37885AD0383E8841125600AF97AE4', 'bin': '448504', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'BANQUE CHAABI DU MAROC', 'issuer_country': 'US', 'product_id': 'P', 'product_type': 'Visa Gold', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 6000, 'total_voided': 0, 'available_to_void': 6000, 'total_captured': 0, 'available_to_capture': 6000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_otboyqn5dhjedggjglilu2yihm'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_jdjus47cgt4udglwgpqxlktlxa'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa/voids'}}}
2025-01-29 15:47:06.295 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_jdjus47cgt4udglwgpqxlktlxa (approved) stored successfully
2025-01-29 15:47:08.240 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 15:47:08.254 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: aa88796f62013584646082f92fe9dca544eaf412354eb880aca1fa4de171d26e
2025-01-29 15:47:08.255 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: aa88796f62013584646082f92fe9dca544eaf412354eb880aca1fa4de171d26e
2025-01-29 15:47:08.255 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 15:47:08.258 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_gjz3d3liugbelbryp3xhp4fijy', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T15:47:03.181Z', 'data': {'id': 'pay_jdjus47cgt4udglwgpqxlktlxa', 'action_id': 'act_dlrg5aiykjsenie4lcdnczoqfu', 'amount': 6000, 'processed_on': '2025-01-29T15:47:03.1638027Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 6000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 6000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 6000}, 'metadata': {'order_ref': '20250129154617-4c082054ae714bb3', 'cko_payment_session_id': 'ps_2sJF4Nuk2XpiLbaaZvZrJ8UTXOe'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '193258251388985922162', 'acquirer_reference_number': '62327581524257181619081'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_gjz3d3liugbelbryp3xhp4fijy'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_jdjus47cgt4udglwgpqxlktlxa'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_jdjus47cgt4udglwgpqxlktlxa/refunds'}}}
2025-01-29 15:47:08.377 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_jdjus47cgt4udglwgpqxlktlxa (captured) stored successfully
2025-01-29 15:53:39.885 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 15:53:39.899 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 27a8a92848468e3a6dd435c79a2750ab2f6daf6b8f3824f94f1ea38a73906235
2025-01-29 15:53:39.899 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 27a8a92848468e3a6dd435c79a2750ab2f6daf6b8f3824f94f1ea38a73906235
2025-01-29 15:53:39.899 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 15:53:39.901 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_ojnfcjejxveurpbyp6rotouizu', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T15:40:46.34Z', 'data': {'id': 'pay_bdya3adh43iu7dobw5gpzurwnq', 'action_id': 'act_7tate6hhd5behnrl3yxccqzzw4', 'amount': 3000, 'auth_code': '955667', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129153954-4c127eb3', 'cko_payment_session_id': 'ps_2sJEINHrJumfh2Br6ZVwn5pvZsc'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T15:40:46.3335029Z', 'processing': {'acquirer_transaction_id': '177677387034270721173', 'retrieval_reference_number': '983729995156', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': 'e568d6c9-b7ad-41ba-ac2a-f14782a03204', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '385890917895328', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'Tester5', 'scheme': 'VISA', 'last_4': '6584', 'fingerprint': 'AE32EC6480042D16252D35AE8101E09566F37885AD0383E8841125600AF97AE4', 'bin': '448504', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'BANQUE CHAABI DU MAROC', 'issuer_country': 'US', 'product_id': 'P', 'product_type': 'Visa Gold', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 3000, 'total_captured': 0, 'available_to_capture': 3000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_ojnfcjejxveurpbyp6rotouizu'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_bdya3adh43iu7dobw5gpzurwnq'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/captures'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_bdya3adh43iu7dobw5gpzurwnq/voids'}}}
2025-01-29 15:53:40.394 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_bdya3adh43iu7dobw5gpzurwnq (approved) stored successfully
2025-01-29 17:46:43.868 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 17:46:43.978 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 865672f7bcb5eb209830bc23a6ec5533b1e7955ab4007eb87fb396ff5c1ebfa2
2025-01-29 17:46:43.984 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 865672f7bcb5eb209830bc23a6ec5533b1e7955ab4007eb87fb396ff5c1ebfa2
2025-01-29 17:46:43.985 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 17:46:43.987 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_y3moqez3u37uvntlt2esxifzlq', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T17:46:40.372Z', 'data': {'id': 'pay_uwibn7j5xepuljlmbb4kvt4gka', 'action_id': 'act_6tbmnnop56aevba2qid56k5kxa', 'amount': 3000, 'auth_code': '215291', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129174431-59ba9934c1ff4030', 'cko_payment_session_id': 'ps_2sJTRu3DttRKinBVtk3p3cxVNXg'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T17:46:40.3651898Z', 'processing': {'acquirer_transaction_id': '535974337577522170609', 'retrieval_reference_number': '175673548518', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': False, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': 'aac5a7ea-3c9f-40eb-9d7a-1b9e6ee397c9', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'frictionless'}, 'scheme_id': '263877209659310', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'Tester', 'scheme': 'VISA', 'last_4': '6584', 'fingerprint': 'AE32EC6480042D16252D35AE8101E09566F37885AD0383E8841125600AF97AE4', 'bin': '448504', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'BANQUE CHAABI DU MAROC', 'issuer_country': 'US', 'product_id': 'P', 'product_type': 'Visa Gold', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 3000, 'total_captured': 0, 'available_to_capture': 3000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_y3moqez3u37uvntlt2esxifzlq'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_uwibn7j5xepuljlmbb4kvt4gka'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka/voids'}}}
2025-01-29 17:46:44.084 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 17:46:44.086 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 9a698bb71e30121f5f7f21d7a2ad527cfa380dadb1320f42acc3fae805e7032b
2025-01-29 17:46:44.086 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 9a698bb71e30121f5f7f21d7a2ad527cfa380dadb1320f42acc3fae805e7032b
2025-01-29 17:46:44.086 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 17:46:44.087 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_zaralxv4xipuddlshsczckcshi', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T17:46:40.481Z', 'data': {'id': 'pay_uwibn7j5xepuljlmbb4kvt4gka', 'action_id': 'act_kbfxns4v4tuevfzpnob2lhqavm', 'amount': 3000, 'processed_on': '2025-01-29T17:46:40.4610637Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 3000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 3000}, 'metadata': {'order_ref': '20250129174431-59ba9934c1ff4030', 'cko_payment_session_id': 'ps_2sJTRu3DttRKinBVtk3p3cxVNXg'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '920731538734990855208', 'acquirer_reference_number': '36792388388653681352980'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_zaralxv4xipuddlshsczckcshi'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_uwibn7j5xepuljlmbb4kvt4gka'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_uwibn7j5xepuljlmbb4kvt4gka/refunds'}}}
2025-01-29 17:46:45.158 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_uwibn7j5xepuljlmbb4kvt4gka (approved) stored successfully
2025-01-29 17:46:45.159 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_uwibn7j5xepuljlmbb4kvt4gka (captured) stored successfully
2025-01-29 17:54:29.275 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 17:54:29.284 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: fd01f217682bbff03adf0663816c657040ac9a4d36bc25ff72e9fcc87527b8c8
2025-01-29 17:54:29.285 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: fd01f217682bbff03adf0663816c657040ac9a4d36bc25ff72e9fcc87527b8c8
2025-01-29 17:54:29.285 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 17:54:29.285 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_xnxivic6fo4e7pdifayebf37vu', 'type': 'payment_declined', 'version': '1.0.44', 'created_on': '2025-01-29T17:54:26.846Z', 'data': {'id': 'pay_qat7rdtpxctujkoylont4b5g2a', 'action_id': 'act_dhrkr6pfuawe5kfjje5ak6pj3u', 'amount': 2000, 'auth_code': '00000', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129175356-499bd012bbd5428c', 'cko_payment_session_id': 'ps_2sJUamphLpmWcG3qoKG2DGl7Imm'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T17:54:26.8340956Z', 'response_code': '20151', 'response_summary': 'Cardholder failed 3D-Secure authentication', 'risk': {'flagged': False}, '3ds': {'version': '2.0.0', 'challenged': False, 'downgraded': False, 'enrolled': 'Y'}, 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2034, 'name': 'Tester 6', 'scheme': 'VISA', 'last_4': '9271', 'fingerprint': 'FE0F46CB74F7E387B49116295AA7AE1E5C7C9759F64CB68CEA05170075CECF86', 'bin': '427576', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'ICICI BANK LTD', 'issuer_country': 'JP', 'product_id': 'N1', 'product_type': 'Visa Rewards'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_qat7rdtpxctujkoylont4b5g2a', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_qat7rdtpxctujkoylont4b5g2a/actions'}, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_xnxivic6fo4e7pdifayebf37vu'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_qat7rdtpxctujkoylont4b5g2a'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_qat7rdtpxctujkoylont4b5g2a'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_qat7rdtpxctujkoylont4b5g2a/actions'}}}
2025-01-29 17:54:30.002 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_qat7rdtpxctujkoylont4b5g2a (declined) stored successfully
2025-01-29 17:56:04.206 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 17:56:04.210 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 17:56:04.214 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 9f82ec5da17e98b49aedbbc14f14bde425fb664f3abdf38ea3caad2b8147834b
2025-01-29 17:56:04.215 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 16a445b6a877606f0bda546eac1d26aeb37830ab9f1d0f8e9c8a44e31d92631d
2025-01-29 17:56:04.215 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 9f82ec5da17e98b49aedbbc14f14bde425fb664f3abdf38ea3caad2b8147834b
2025-01-29 17:56:04.215 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 16a445b6a877606f0bda546eac1d26aeb37830ab9f1d0f8e9c8a44e31d92631d
2025-01-29 17:56:04.215 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 17:56:04.215 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 17:56:04.215 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_lzb33qxd4ggufi3e62qny7yfxi', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T17:56:00.351Z', 'data': {'id': 'pay_mmt6tui2ouiujek6kq7iuny7iq', 'action_id': 'act_achhkpkjjreejlhs5imzbfypo4', 'amount': 4000, 'auth_code': '124203', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129175532-07f700d1a8554bfa', 'cko_payment_session_id': 'ps_2sJUmlIOUPrJwRHuIg3VmBzhjUm'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T17:56:00.343354Z', 'processing': {'acquirer_transaction_id': '214707856108097100523', 'retrieval_reference_number': '427013814897', 'aft': 'False', 'scheme': 'MASTERCARD'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': True, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '02', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': '289f706d-9f96-4b31-b09e-1e71a050a5d2', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'challenged'}, 'scheme_id': '944609971237525', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2045, 'name': 'Tester5', 'scheme': 'MASTERCARD', 'last_4': '5181', 'fingerprint': '39F0CA1FE76301B46649714B6383B48EBB1FFDA0031CEC5E6511430B89F004F3', 'bin': '538530', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'OSWEGO COUNTY FEDERAL CREDIT UNION', 'issuer_country': 'US', 'product_id': 'BPD', 'product_type': 'Business Premium Debit', 'avs_check': 'S', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 4000, 'total_voided': 0, 'available_to_void': 4000, 'total_captured': 0, 'available_to_capture': 4000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_lzb33qxd4ggufi3e62qny7yfxi'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_mmt6tui2ouiujek6kq7iuny7iq'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/voids'}}}
2025-01-29 17:56:04.216 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_ickgns7f6knufpayc3vchc4pmu', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T17:56:00.444Z', 'data': {'id': 'pay_mmt6tui2ouiujek6kq7iuny7iq', 'action_id': 'act_7ebl6cozqumenmbayrxniqcanq', 'amount': 4000, 'processed_on': '2025-01-29T17:56:00.4328807Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 4000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 4000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 4000}, 'metadata': {'order_ref': '20250129175532-07f700d1a8554bfa', 'cko_payment_session_id': 'ps_2sJUmlIOUPrJwRHuIg3VmBzhjUm'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '389591128263148420245', 'acquirer_reference_number': '32156247793886655843489'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_ickgns7f6knufpayc3vchc4pmu'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_mmt6tui2ouiujek6kq7iuny7iq'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/refunds'}}}
2025-01-29 17:56:04.508 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_mmt6tui2ouiujek6kq7iuny7iq (approved) stored successfully
2025-01-29 17:56:04.508 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_mmt6tui2ouiujek6kq7iuny7iq (captured) stored successfully
2025-01-29 18:07:43.210 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:07:43.234 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:07:43.293 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 9b0353b8caa5615e941a49d7113b6c493511618d476d7fef49b5f935415c7391
2025-01-29 18:07:43.294 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 82878ceb7b144b61e44fa3bae673986811f3bed40477b9f44b1bebb14c3016f4
2025-01-29 18:07:43.295 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 9b0353b8caa5615e941a49d7113b6c493511618d476d7fef49b5f935415c7391
2025-01-29 18:07:43.295 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 82878ceb7b144b61e44fa3bae673986811f3bed40477b9f44b1bebb14c3016f4
2025-01-29 18:07:43.295 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:07:43.296 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:07:43.297 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_qpcas4jyv2fuhgyh4uxyeopzku', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T18:07:39.981Z', 'data': {'id': 'pay_c4jitx335a6exaxiqcq32bf35u', 'action_id': 'act_yaiim4kgsowujc7j6vcfjybpni', 'amount': 2000, 'processed_on': '2025-01-29T18:07:39.9673642Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 2000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 2000}, 'metadata': {'order_ref': '20250129180626-611da3a6ad0e4ae9', 'cko_payment_session_id': 'ps_2sJW72lqIMETbpGmbXnLLQINwoB'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '693166599447410477043', 'acquirer_reference_number': '64293861747762483878097'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_qpcas4jyv2fuhgyh4uxyeopzku'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_c4jitx335a6exaxiqcq32bf35u'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/refunds'}}}
2025-01-29 18:07:43.297 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_x477icirkhkuzjtmj5gscowcui', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T18:07:39.838Z', 'data': {'id': 'pay_c4jitx335a6exaxiqcq32bf35u', 'action_id': 'act_x3cuqd2mfttu5hlqr4cofax3jq', 'amount': 2000, 'auth_code': '124203', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129180626-611da3a6ad0e4ae9', 'cko_payment_session_id': 'ps_2sJW72lqIMETbpGmbXnLLQINwoB'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T18:07:39.8274712Z', 'processing': {'acquirer_transaction_id': '377668532851472442859', 'retrieval_reference_number': '029526137628', 'aft': 'False', 'scheme': 'MASTERCARD'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': True, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '02', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': '4c203f71-b1fb-47c5-86c4-9b795993f59a', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'challenged'}, 'scheme_id': '664498153476874', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 1, 'expiry_year': 2034, 'name': 'Tester1', 'scheme': 'MASTERCARD', 'last_4': '5181', 'fingerprint': 'F2D4D0E07A2B289C6A350553F61398C1B2E761DBD5CB00BC5BCA1E62D346041E', 'bin': '538530', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'OSWEGO COUNTY FEDERAL CREDIT UNION', 'issuer_country': 'US', 'product_id': 'BPD', 'product_type': 'Business Premium Debit', 'avs_check': 'S', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 2000, 'total_captured': 0, 'available_to_capture': 2000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_x477icirkhkuzjtmj5gscowcui'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_c4jitx335a6exaxiqcq32bf35u'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/voids'}}}
2025-01-29 18:07:43.409 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: SyncRequestBuilder.upsert() got an unexpected keyword argument 'ignore_conflicts'
2025-01-29 18:07:43.413 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: SyncRequestBuilder.upsert() got an unexpected keyword argument 'ignore_conflicts'
2025-01-29 18:11:46.890 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:11:46.878 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:11:46.900 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 48745a0b8bf7e1fe09c0830ddc5d11d83e6876ce7635f0d4f7f0c80fd8a75b5d
2025-01-29 18:11:46.901 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 0e3ae13e2ddf6698acdd7eb2fa3441f1d286c0b7d81e6c4e5146b0c914fe5bb2
2025-01-29 18:11:46.901 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 48745a0b8bf7e1fe09c0830ddc5d11d83e6876ce7635f0d4f7f0c80fd8a75b5d
2025-01-29 18:11:46.901 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 0e3ae13e2ddf6698acdd7eb2fa3441f1d286c0b7d81e6c4e5146b0c914fe5bb2
2025-01-29 18:11:46.901 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:11:46.901 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:11:46.901 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_7qb7arak3tieddfhd5eukhv5hm', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T18:11:43.15Z', 'data': {'id': 'pay_3i5sunsc2x4uze7dj3tcqpysjy', 'action_id': 'act_tt4fnski76zenllh6tezu36msi', 'amount': 6000, 'auth_code': '124203', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129181107-3d830c4495ae43fc', 'cko_payment_session_id': 'ps_2sJWgN2HHP72NmfBHnyKaWHEtdm'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T18:11:43.1436161Z', 'processing': {'acquirer_transaction_id': '390314763510969975598', 'retrieval_reference_number': '365836281881', 'aft': 'False', 'scheme': 'MASTERCARD'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': True, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '02', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': 'fe74f416-da82-45ef-b670-10fa43cf2713', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'challenged'}, 'scheme_id': '470253398489180', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 2, 'expiry_year': 2033, 'name': 'Tester', 'scheme': 'MASTERCARD', 'last_4': '5181', 'fingerprint': '12C2F885C208075B16411E3DD579B36B96F197A9150EE392AE7100D93394F131', 'bin': '538530', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'OSWEGO COUNTY FEDERAL CREDIT UNION', 'issuer_country': 'US', 'product_id': 'BPD', 'product_type': 'Business Premium Debit', 'avs_check': 'S', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 6000, 'total_voided': 0, 'available_to_void': 6000, 'total_captured': 0, 'available_to_capture': 6000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_7qb7arak3tieddfhd5eukhv5hm'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/voids'}}}
2025-01-29 18:11:46.902 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_caltlmc2v4qe7pmb2tp3tr24ne', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T18:11:43.241Z', 'data': {'id': 'pay_3i5sunsc2x4uze7dj3tcqpysjy', 'action_id': 'act_gmy4e54oh2ouhetdgqgh3cwp5q', 'amount': 6000, 'processed_on': '2025-01-29T18:11:43.2250453Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 6000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 6000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 6000}, 'metadata': {'order_ref': '20250129181107-3d830c4495ae43fc', 'cko_payment_session_id': 'ps_2sJWgN2HHP72NmfBHnyKaWHEtdm'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '452228458583516052063', 'acquirer_reference_number': '90708404275370336410598'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_caltlmc2v4qe7pmb2tp3tr24ne'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/refunds'}}}
2025-01-29 18:11:47.266 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: {'code': '23505', 'details': 'Key (payment_id)=(pay_3i5sunsc2x4uze7dj3tcqpysjy) already exists.', 'hint': None, 'message': 'duplicate key value violates unique constraint "checkout_payments_pkey"'}
2025-01-29 18:11:47.332 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_3i5sunsc2x4uze7dj3tcqpysjy (approved) stored successfully
2025-01-29 18:13:02.103 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:13:02.221 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 9d95690238299414036e59f950a7aa6e37e5ee9ea36f393c165869a718396022
2025-01-29 18:13:02.221 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 9d95690238299414036e59f950a7aa6e37e5ee9ea36f393c165869a718396022
2025-01-29 18:13:02.222 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:13:02.228 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_x477icirkhkuzjtmj5gscowcui', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T18:07:39.838Z', 'data': {'id': 'pay_c4jitx335a6exaxiqcq32bf35u', 'action_id': 'act_x3cuqd2mfttu5hlqr4cofax3jq', 'amount': 2000, 'auth_code': '124203', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129180626-611da3a6ad0e4ae9', 'cko_payment_session_id': 'ps_2sJW72lqIMETbpGmbXnLLQINwoB'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T18:07:39.8274712Z', 'processing': {'acquirer_transaction_id': '377668532851472442859', 'retrieval_reference_number': '029526137628', 'aft': 'False', 'scheme': 'MASTERCARD'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': True, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '02', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': '4c203f71-b1fb-47c5-86c4-9b795993f59a', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'challenged'}, 'scheme_id': '664498153476874', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 1, 'expiry_year': 2034, 'name': 'Tester1', 'scheme': 'MASTERCARD', 'last_4': '5181', 'fingerprint': 'F2D4D0E07A2B289C6A350553F61398C1B2E761DBD5CB00BC5BCA1E62D346041E', 'bin': '538530', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'OSWEGO COUNTY FEDERAL CREDIT UNION', 'issuer_country': 'US', 'product_id': 'BPD', 'product_type': 'Business Premium Debit', 'avs_check': 'S', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 2000, 'total_captured': 0, 'available_to_capture': 2000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_x477icirkhkuzjtmj5gscowcui'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_c4jitx335a6exaxiqcq32bf35u'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/captures'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/voids'}}}
2025-01-29 18:13:02.449 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_c4jitx335a6exaxiqcq32bf35u (approved) stored successfully
2025-01-29 18:13:27.506 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:13:27.517 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: f6253f3b0af7f4cbbd111f94988af7dd010691bae29ead3a70facfb48909aa47
2025-01-29 18:13:27.517 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: f6253f3b0af7f4cbbd111f94988af7dd010691bae29ead3a70facfb48909aa47
2025-01-29 18:13:27.517 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:13:27.518 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_qpcas4jyv2fuhgyh4uxyeopzku', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T18:07:39.981Z', 'data': {'id': 'pay_c4jitx335a6exaxiqcq32bf35u', 'action_id': 'act_yaiim4kgsowujc7j6vcfjybpni', 'amount': 2000, 'processed_on': '2025-01-29T18:07:39.9673642Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 2000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 2000}, 'metadata': {'order_ref': '20250129180626-611da3a6ad0e4ae9', 'cko_payment_session_id': 'ps_2sJW72lqIMETbpGmbXnLLQINwoB'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '693166599447410477043', 'acquirer_reference_number': '64293861747762483878097'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_qpcas4jyv2fuhgyh4uxyeopzku'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_c4jitx335a6exaxiqcq32bf35u'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/refunds'}}}
2025-01-29 18:13:27.833 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: {'code': '23505', 'details': 'Key (payment_id)=(pay_c4jitx335a6exaxiqcq32bf35u) already exists.', 'hint': None, 'message': 'duplicate key value violates unique constraint "checkout_payments_pkey"'}
2025-01-29 18:17:37.985 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:17:37.987 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 2709b0a3e9551f109b63cc229c13216f106639193881d7942db282534540ad41
2025-01-29 18:17:37.987 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 2709b0a3e9551f109b63cc229c13216f106639193881d7942db282534540ad41
2025-01-29 18:17:37.987 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:17:37.987 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_caltlmc2v4qe7pmb2tp3tr24ne', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T18:11:43.241Z', 'data': {'id': 'pay_3i5sunsc2x4uze7dj3tcqpysjy', 'action_id': 'act_gmy4e54oh2ouhetdgqgh3cwp5q', 'amount': 6000, 'processed_on': '2025-01-29T18:11:43.2250453Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 6000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 6000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 6000}, 'metadata': {'order_ref': '20250129181107-3d830c4495ae43fc', 'cko_payment_session_id': 'ps_2sJWgN2HHP72NmfBHnyKaWHEtdm'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '452228458583516052063', 'acquirer_reference_number': '90708404275370336410598'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_caltlmc2v4qe7pmb2tp3tr24ne'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/refunds'}}}
2025-01-29 18:17:38.005 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: SyncRequestBuilder.insert() got an unexpected keyword argument 'on_conflict'
2025-01-29 18:20:50.092 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:20:50.117 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 5e2831f0dd854a687640f776627c02b036b954c36dee16d0d12dbc9213de6e0b
2025-01-29 18:20:50.117 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 5e2831f0dd854a687640f776627c02b036b954c36dee16d0d12dbc9213de6e0b
2025-01-29 18:20:50.118 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:20:50.118 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_jsd4afrrmgxuhl4d6yln2zalt4', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T18:20:45.815Z', 'data': {'id': 'pay_yiiioewqmfbe3dxhgiyoj4nuli', 'action_id': 'act_lj6qna2tq6pexjdbspygrh2in4', 'amount': 3000, 'processed_on': '2025-01-29T18:20:45.8041831Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 3000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 3000}, 'metadata': {'order_ref': '20250129182008-39d7032055f649c3', 'cko_payment_session_id': 'ps_2sJXmTXh40NqeKLKiLODWCgWKDx'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '841143827275624999080', 'acquirer_reference_number': '96033974797543580355922'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_jsd4afrrmgxuhl4d6yln2zalt4'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_yiiioewqmfbe3dxhgiyoj4nuli'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/refunds'}}}
2025-01-29 18:20:50.574 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_yiiioewqmfbe3dxhgiyoj4nuli (captured) stored successfully
2025-01-29 18:20:51.144 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:20:51.145 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 8e9f22ace3e1b59827ce641e96c82dae8293eff2a103a3232012c80b0bd4960c
2025-01-29 18:20:51.145 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 8e9f22ace3e1b59827ce641e96c82dae8293eff2a103a3232012c80b0bd4960c
2025-01-29 18:20:51.145 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:20:51.145 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_brynwlcxbnkexedgrczjhe55g4', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T18:20:45.722Z', 'data': {'id': 'pay_yiiioewqmfbe3dxhgiyoj4nuli', 'action_id': 'act_yzx6qb4lx7su7kktbsq2bczxyq', 'amount': 3000, 'auth_code': '124203', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129182008-39d7032055f649c3', 'cko_payment_session_id': 'ps_2sJXmTXh40NqeKLKiLODWCgWKDx'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T18:20:45.7148074Z', 'processing': {'acquirer_transaction_id': '025243242949962792560', 'retrieval_reference_number': '893028585013', 'aft': 'False', 'scheme': 'MASTERCARD'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': True, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '02', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': '08cdf819-7e13-4172-97b8-1f3a569da43d', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'challenged'}, 'scheme_id': '513319078274996', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2033, 'name': 'Tester', 'scheme': 'MASTERCARD', 'last_4': '5181', 'fingerprint': '48E2190FACE0DA7C0CE98BC2F831F269E024F29D6BF5C450F2398E903890EEDC', 'bin': '538530', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'OSWEGO COUNTY FEDERAL CREDIT UNION', 'issuer_country': 'US', 'product_id': 'BPD', 'product_type': 'Business Premium Debit', 'avs_check': 'S', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 3000, 'total_captured': 0, 'available_to_capture': 3000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_brynwlcxbnkexedgrczjhe55g4'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_yiiioewqmfbe3dxhgiyoj4nuli'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/voids'}}}
2025-01-29 18:20:51.206 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_yiiioewqmfbe3dxhgiyoj4nuli (approved) stored successfully
2025-01-29 18:24:30.759 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:24:30.773 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: f6253f3b0af7f4cbbd111f94988af7dd010691bae29ead3a70facfb48909aa47
2025-01-29 18:24:30.773 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: f6253f3b0af7f4cbbd111f94988af7dd010691bae29ead3a70facfb48909aa47
2025-01-29 18:24:30.773 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:24:30.775 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_qpcas4jyv2fuhgyh4uxyeopzku', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T18:07:39.981Z', 'data': {'id': 'pay_c4jitx335a6exaxiqcq32bf35u', 'action_id': 'act_yaiim4kgsowujc7j6vcfjybpni', 'amount': 2000, 'processed_on': '2025-01-29T18:07:39.9673642Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 2000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 2000}, 'metadata': {'order_ref': '20250129180626-611da3a6ad0e4ae9', 'cko_payment_session_id': 'ps_2sJW72lqIMETbpGmbXnLLQINwoB'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '693166599447410477043', 'acquirer_reference_number': '64293861747762483878097'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_qpcas4jyv2fuhgyh4uxyeopzku'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_c4jitx335a6exaxiqcq32bf35u'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/refunds'}}}
2025-01-29 18:24:31.202 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_c4jitx335a6exaxiqcq32bf35u (captured) stored successfully
2025-01-29 18:27:13.927 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 18:27:13.940 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 2709b0a3e9551f109b63cc229c13216f106639193881d7942db282534540ad41
2025-01-29 18:27:13.940 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 2709b0a3e9551f109b63cc229c13216f106639193881d7942db282534540ad41
2025-01-29 18:27:13.940 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 18:27:13.941 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_caltlmc2v4qe7pmb2tp3tr24ne', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T18:11:43.241Z', 'data': {'id': 'pay_3i5sunsc2x4uze7dj3tcqpysjy', 'action_id': 'act_gmy4e54oh2ouhetdgqgh3cwp5q', 'amount': 6000, 'processed_on': '2025-01-29T18:11:43.2250453Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 6000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 6000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 6000}, 'metadata': {'order_ref': '20250129181107-3d830c4495ae43fc', 'cko_payment_session_id': 'ps_2sJWgN2HHP72NmfBHnyKaWHEtdm'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '452228458583516052063', 'acquirer_reference_number': '90708404275370336410598'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_caltlmc2v4qe7pmb2tp3tr24ne'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/refunds'}}}
2025-01-29 18:27:14.318 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_3i5sunsc2x4uze7dj3tcqpysjy (captured) stored successfully
2025-01-29 20:03:29.817 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 20:03:29.823 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 9e744532a076e6f30783ea4a4435a8dd890172b6b3696141eee132f69285ab7b
2025-01-29 20:03:29.823 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 9e744532a076e6f30783ea4a4435a8dd890172b6b3696141eee132f69285ab7b
2025-01-29 20:03:29.823 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 20:03:29.823 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_ickgns7f6knufpayc3vchc4pmu', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T17:56:00.444Z', 'data': {'id': 'pay_mmt6tui2ouiujek6kq7iuny7iq', 'action_id': 'act_7ebl6cozqumenmbayrxniqcanq', 'amount': 4000, 'processed_on': '2025-01-29T17:56:00.4328807Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 4000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 4000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 4000}, 'metadata': {'order_ref': '20250129175532-07f700d1a8554bfa', 'cko_payment_session_id': 'ps_2sJUmlIOUPrJwRHuIg3VmBzhjUm'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '389591128263148420245', 'acquirer_reference_number': '32156247793886655843489'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_ickgns7f6knufpayc3vchc4pmu'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_mmt6tui2ouiujek6kq7iuny7iq'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/actions'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_mmt6tui2ouiujek6kq7iuny7iq/refunds'}}}
2025-01-29 20:03:29.924 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: {'code': '23505', 'details': 'Key (event_id)=(evt_ickgns7f6knufpayc3vchc4pmu) already exists.', 'hint': None, 'message': 'duplicate key value violates unique constraint "unique_event_id"'}
2025-01-29 20:09:26.515 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 20:09:26.520 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 2709b0a3e9551f109b63cc229c13216f106639193881d7942db282534540ad41
2025-01-29 20:09:26.520 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 2709b0a3e9551f109b63cc229c13216f106639193881d7942db282534540ad41
2025-01-29 20:09:26.520 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 20:09:26.520 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_caltlmc2v4qe7pmb2tp3tr24ne', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T18:11:43.241Z', 'data': {'id': 'pay_3i5sunsc2x4uze7dj3tcqpysjy', 'action_id': 'act_gmy4e54oh2ouhetdgqgh3cwp5q', 'amount': 6000, 'processed_on': '2025-01-29T18:11:43.2250453Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 6000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 6000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 6000}, 'metadata': {'order_ref': '20250129181107-3d830c4495ae43fc', 'cko_payment_session_id': 'ps_2sJWgN2HHP72NmfBHnyKaWHEtdm'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '452228458583516052063', 'acquirer_reference_number': '90708404275370336410598'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_caltlmc2v4qe7pmb2tp3tr24ne'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/refunds'}}}
2025-01-29 20:09:26.802 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: {'code': '23505', 'details': 'Key (event_id)=(evt_caltlmc2v4qe7pmb2tp3tr24ne) already exists.', 'hint': None, 'message': 'duplicate key value violates unique constraint "unique_event_id"'}
2025-01-29 20:09:51.838 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 20:09:51.839 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 881e60c0330b0a974c7752182c2fefa489f624781a326bdcb961a0e13989a247
2025-01-29 20:09:51.839 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 881e60c0330b0a974c7752182c2fefa489f624781a326bdcb961a0e13989a247
2025-01-29 20:09:51.839 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 20:09:51.840 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_jsd4afrrmgxuhl4d6yln2zalt4', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T18:20:45.815Z', 'data': {'id': 'pay_yiiioewqmfbe3dxhgiyoj4nuli', 'action_id': 'act_lj6qna2tq6pexjdbspygrh2in4', 'amount': 3000, 'processed_on': '2025-01-29T18:20:45.8041831Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 3000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 3000}, 'metadata': {'order_ref': '20250129182008-39d7032055f649c3', 'cko_payment_session_id': 'ps_2sJXmTXh40NqeKLKiLODWCgWKDx'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '841143827275624999080', 'acquirer_reference_number': '96033974797543580355922'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_jsd4afrrmgxuhl4d6yln2zalt4'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_yiiioewqmfbe3dxhgiyoj4nuli'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/actions'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/refunds'}}}
2025-01-29 20:09:51.971 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: {'code': '23505', 'details': 'Key (event_id)=(evt_jsd4afrrmgxuhl4d6yln2zalt4) already exists.', 'hint': None, 'message': 'duplicate key value violates unique constraint "unique_event_id"'}
2025-01-29 20:10:44.365 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 20:10:44.368 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 47c62f1a44e989b7c7d77438f977368c2f15218b6b45aab995949fc89c74aa4a
2025-01-29 20:10:44.369 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 47c62f1a44e989b7c7d77438f977368c2f15218b6b45aab995949fc89c74aa4a
2025-01-29 20:10:44.369 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 20:10:44.369 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_brynwlcxbnkexedgrczjhe55g4', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T18:20:45.722Z', 'data': {'id': 'pay_yiiioewqmfbe3dxhgiyoj4nuli', 'action_id': 'act_yzx6qb4lx7su7kktbsq2bczxyq', 'amount': 3000, 'auth_code': '124203', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129182008-39d7032055f649c3', 'cko_payment_session_id': 'ps_2sJXmTXh40NqeKLKiLODWCgWKDx'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T18:20:45.7148074Z', 'processing': {'acquirer_transaction_id': '025243242949962792560', 'retrieval_reference_number': '893028585013', 'aft': 'False', 'scheme': 'MASTERCARD'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': True, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '02', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': '08cdf819-7e13-4172-97b8-1f3a569da43d', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'challenged'}, 'scheme_id': '513319078274996', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 3, 'expiry_year': 2033, 'name': 'Tester', 'scheme': 'MASTERCARD', 'last_4': '5181', 'fingerprint': '48E2190FACE0DA7C0CE98BC2F831F269E024F29D6BF5C450F2398E903890EEDC', 'bin': '538530', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'OSWEGO COUNTY FEDERAL CREDIT UNION', 'issuer_country': 'US', 'product_id': 'BPD', 'product_type': 'Business Premium Debit', 'avs_check': 'S', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 3000, 'total_voided': 0, 'available_to_void': 3000, 'total_captured': 0, 'available_to_capture': 3000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_brynwlcxbnkexedgrczjhe55g4'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_yiiioewqmfbe3dxhgiyoj4nuli'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/captures'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_yiiioewqmfbe3dxhgiyoj4nuli/voids'}}}
2025-01-29 20:10:44.477 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: {'code': '23505', 'details': 'Key (event_id)=(evt_brynwlcxbnkexedgrczjhe55g4) already exists.', 'hint': None, 'message': 'duplicate key value violates unique constraint "unique_event_id"'}
2025-01-29 20:10:50.244 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 20:10:50.245 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 8aa48f529cd04b0fdaec62c00e0e635d5fa1646df861c6a454248978489f1422
2025-01-29 20:10:50.245 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 8aa48f529cd04b0fdaec62c00e0e635d5fa1646df861c6a454248978489f1422
2025-01-29 20:10:50.245 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 20:10:50.245 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_7qb7arak3tieddfhd5eukhv5hm', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T18:11:43.15Z', 'data': {'id': 'pay_3i5sunsc2x4uze7dj3tcqpysjy', 'action_id': 'act_tt4fnski76zenllh6tezu36msi', 'amount': 6000, 'auth_code': '124203', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129181107-3d830c4495ae43fc', 'cko_payment_session_id': 'ps_2sJWgN2HHP72NmfBHnyKaWHEtdm'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T18:11:43.1436161Z', 'processing': {'acquirer_transaction_id': '390314763510969975598', 'retrieval_reference_number': '365836281881', 'aft': 'False', 'scheme': 'MASTERCARD'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': True, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '02', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': 'fe74f416-da82-45ef-b670-10fa43cf2713', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'challenged'}, 'scheme_id': '470253398489180', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 2, 'expiry_year': 2033, 'name': 'Tester', 'scheme': 'MASTERCARD', 'last_4': '5181', 'fingerprint': '12C2F885C208075B16411E3DD579B36B96F197A9150EE392AE7100D93394F131', 'bin': '538530', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'OSWEGO COUNTY FEDERAL CREDIT UNION', 'issuer_country': 'US', 'product_id': 'BPD', 'product_type': 'Business Premium Debit', 'avs_check': 'S', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 6000, 'total_voided': 0, 'available_to_void': 6000, 'total_captured': 0, 'available_to_capture': 6000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_7qb7arak3tieddfhd5eukhv5hm'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/captures'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_3i5sunsc2x4uze7dj3tcqpysjy/voids'}}}
2025-01-29 20:10:50.327 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: {'code': '23505', 'details': 'Key (event_id)=(evt_7qb7arak3tieddfhd5eukhv5hm) already exists.', 'hint': None, 'message': 'duplicate key value violates unique constraint "unique_event_id"'}
2025-01-29 20:14:46.347 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 20:14:46.349 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: f6253f3b0af7f4cbbd111f94988af7dd010691bae29ead3a70facfb48909aa47
2025-01-29 20:14:46.349 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: f6253f3b0af7f4cbbd111f94988af7dd010691bae29ead3a70facfb48909aa47
2025-01-29 20:14:46.349 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 20:14:46.349 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_qpcas4jyv2fuhgyh4uxyeopzku', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T18:07:39.981Z', 'data': {'id': 'pay_c4jitx335a6exaxiqcq32bf35u', 'action_id': 'act_yaiim4kgsowujc7j6vcfjybpni', 'amount': 2000, 'processed_on': '2025-01-29T18:07:39.9673642Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 2000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 2000}, 'metadata': {'order_ref': '20250129180626-611da3a6ad0e4ae9', 'cko_payment_session_id': 'ps_2sJW72lqIMETbpGmbXnLLQINwoB'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '693166599447410477043', 'acquirer_reference_number': '64293861747762483878097'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_qpcas4jyv2fuhgyh4uxyeopzku'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_c4jitx335a6exaxiqcq32bf35u'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/refunds'}}}
2025-01-29 20:14:46.853 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: {'code': '23505', 'details': 'Key (event_id)=(evt_qpcas4jyv2fuhgyh4uxyeopzku) already exists.', 'hint': None, 'message': 'duplicate key value violates unique constraint "unique_event_id"'}
2025-01-29 20:19:08.918 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 20:19:08.923 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: 9d95690238299414036e59f950a7aa6e37e5ee9ea36f393c165869a718396022
2025-01-29 20:19:08.923 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: 9d95690238299414036e59f950a7aa6e37e5ee9ea36f393c165869a718396022
2025-01-29 20:19:08.924 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 20:19:08.924 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_x477icirkhkuzjtmj5gscowcui', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T18:07:39.838Z', 'data': {'id': 'pay_c4jitx335a6exaxiqcq32bf35u', 'action_id': 'act_x3cuqd2mfttu5hlqr4cofax3jq', 'amount': 2000, 'auth_code': '124203', 'currency': 'GBP', 'customer': {'id': 'cus_vjaxstiwes7ubaw7y6dog5kj5i', 'email': 'test@google.com'}, 'metadata': {'order_ref': '20250129180626-611da3a6ad0e4ae9', 'cko_payment_session_id': 'ps_2sJW72lqIMETbpGmbXnLLQINwoB'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T18:07:39.8274712Z', 'processing': {'acquirer_transaction_id': '377668532851472442859', 'retrieval_reference_number': '029526137628', 'aft': 'False', 'scheme': 'MASTERCARD'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': True, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '02', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': '4c203f71-b1fb-47c5-86c4-9b795993f59a', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'challenged'}, 'scheme_id': '664498153476874', 'source': {'type': 'card', 'billing_address': {'line1': '1 High Street', 'line2': '', 'town_city': 'London', 'state': 'London', 'zip': 'W1', 'country': 'GB'}, 'expiry_month': 1, 'expiry_year': 2034, 'name': 'Tester1', 'scheme': 'MASTERCARD', 'last_4': '5181', 'fingerprint': 'F2D4D0E07A2B289C6A350553F61398C1B2E761DBD5CB00BC5BCA1E62D346041E', 'bin': '538530', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'OSWEGO COUNTY FEDERAL CREDIT UNION', 'issuer_country': 'US', 'product_id': 'BPD', 'product_type': 'Business Premium Debit', 'avs_check': 'S', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 2000, 'total_voided': 0, 'available_to_void': 2000, 'total_captured': 0, 'available_to_capture': 2000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '86.159.111.55'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_x477icirkhkuzjtmj5gscowcui'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_c4jitx335a6exaxiqcq32bf35u'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/captures'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_c4jitx335a6exaxiqcq32bf35u/voids'}}}
2025-01-29 20:19:09.219 | ERROR    | app.webhook_listener:handle_webhook:149 - ⚠️ Error updating payment in Supabase: {'code': '23505', 'details': 'Key (event_id)=(evt_x477icirkhkuzjtmj5gscowcui) already exists.', 'hint': None, 'message': 'duplicate key value violates unique constraint "unique_event_id"'}
2025-01-29 22:01:41.010 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 22:01:41.024 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: b91a709c18588f21bccf7f844404bc1d478356618f7ca7ad53b691ba29b53aab
2025-01-29 22:01:41.024 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: b91a709c18588f21bccf7f844404bc1d478356618f7ca7ad53b691ba29b53aab
2025-01-29 22:01:41.024 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 22:01:41.025 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_2rclwyj4fvqebkkmnlgwxuis24', 'type': 'payment_approved', 'version': '1.0.44', 'created_on': '2025-01-29T22:01:38.189Z', 'data': {'id': 'pay_deervdyx3nee5kqr72us5p5kfe', 'action_id': 'act_uqpdktfsyxsetjtfwxscoguuii', 'reference': 'ORD-123A', 'amount': 1000, 'auth_code': '975310', 'currency': 'GBP', 'customer': {'id': 'cus_qjrszea5vunuflcr3ztouwt6zq', 'email': 'john.doe@example.com'}, 'metadata': {'cko_payment_session_id': 'ps_2sJycYRBn4B1uvrgfE6833BLgMO'}, 'payment_type': 'Regular', 'processed_on': '2025-01-29T22:01:38.1833681Z', 'processing': {'acquirer_transaction_id': '449386735669727608058', 'retrieval_reference_number': '619112803851', 'aft': 'False', 'scheme': 'VISA'}, 'response_code': '10000', 'response_summary': 'Approved', 'risk': {'flagged': False, 'score': 0}, '3ds': {'version': '2.2.0', 'challenged': True, 'challenge_indicator': 'challenge_requested', 'exemption': 'none', 'eci': '05', 'cavv': 'AAABAVIREQAAAAAAAAAAAAAAAAA=', 'xid': 'e742a7f1-97dd-41ad-9b86-e5ef4c3e3dc3', 'downgraded': False, 'enrolled': 'Y', 'authentication_response': 'Y', 'flow_type': 'challenged'}, 'scheme_id': '818413141400897', 'source': {'type': 'card', 'billing_address': {'country': 'GB'}, 'expiry_month': 4, 'expiry_year': 2028, 'name': 'Igor Moreira', 'scheme': 'VISA', 'last_4': '4242', 'fingerprint': '2CD51E89BE63AEE70EE35A18B3F88478C3F7F0D5BAAB38CA2A7BA7D14E439A95', 'bin': '424242', 'card_type': 'CREDIT', 'card_category': 'CONSUMER', 'issuer': 'CKO, WHERE THE WORLD CHECKS OUT', 'issuer_country': 'GB', 'product_id': 'F', 'product_type': 'Visa Classic', 'avs_check': 'G', 'cvv_check': 'Y'}, 'balances': {'total_authorized': 1000, 'total_voided': 0, 'available_to_void': 1000, 'total_captured': 0, 'available_to_capture': 1000, 'total_refunded': 0, 'available_to_refund': 0}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe/actions', 'capture': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe/captures', 'void': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe/voids'}, 'pan_type_processed': 'fpan', 'cko_network_token_available': False, 'payment_ip': '104.28.40.139'}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_2rclwyj4fvqebkkmnlgwxuis24'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_deervdyx3nee5kqr72us5p5kfe'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe/actions'}, 'capture': {'href': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe/captures'}, 'void': {'href': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe/voids'}}}
2025-01-29 22:01:41.333 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_deervdyx3nee5kqr72us5p5kfe (approved) stored successfully
2025-01-29 22:01:43.890 | INFO     | app.webhook_listener:handle_webhook:94 - 📩 Received webhook request
2025-01-29 22:01:43.894 | DEBUG    | app.webhook_listener:verify_signature:40 - 🔍 Expected Signature: db5e2f2c1c8efe812b297ddd05aa83232170ee1e640923d7abc0db3a9f89bde3
2025-01-29 22:01:43.894 | DEBUG    | app.webhook_listener:verify_signature:41 - 🔍 Received Signature: db5e2f2c1c8efe812b297ddd05aa83232170ee1e640923d7abc0db3a9f89bde3
2025-01-29 22:01:43.894 | INFO     | app.webhook_listener:verify_signature:45 - ✅ Webhook signature is valid
2025-01-29 22:01:43.894 | DEBUG    | app.webhook_listener:handle_webhook:103 - Webhook Data: {'id': 'evt_b3mnuij4cxnetorvrqzrewhhxu', 'type': 'payment_captured', 'version': '1.0.44', 'created_on': '2025-01-29T22:01:38.31Z', 'data': {'id': 'pay_deervdyx3nee5kqr72us5p5kfe', 'action_id': 'act_gxsuyygassoepldkki6bma4vdq', 'reference': 'ORD-123A', 'amount': 1000, 'processed_on': '2025-01-29T22:01:38.29507Z', 'response_code': '10000', 'response_summary': 'Approved', 'balances': {'total_authorized': 1000, 'total_voided': 0, 'available_to_void': 0, 'total_captured': 1000, 'available_to_capture': 0, 'total_refunded': 0, 'available_to_refund': 1000}, 'metadata': {'cko_payment_session_id': 'ps_2sJycYRBn4B1uvrgfE6833BLgMO'}, 'currency': 'GBP', 'processing': {'acquirer_transaction_id': '617055099359022935279', 'acquirer_reference_number': '66408245672684363930227'}, 'event_links': {'payment': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe', 'payment_actions': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe/actions', 'refund': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe/refunds'}}, '_links': {'self': {'href': 'https://api.sandbox.checkout.com/workflows/events/evt_b3mnuij4cxnetorvrqzrewhhxu'}, 'subject': {'href': 'https://api.sandbox.checkout.com/workflows/events/subject/pay_deervdyx3nee5kqr72us5p5kfe'}, 'payment': {'href': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe'}, 'payment_actions': {'href': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe/actions'}, 'refund': {'href': 'https://api.sandbox.checkout.com/payments/pay_deervdyx3nee5kqr72us5p5kfe/refunds'}}}
2025-01-29 22:01:43.962 | SUCCESS  | app.webhook_listener:handle_webhook:146 - ✅ Payment pay_deervdyx3nee5kqr72us5p5kfe (captured) stored successfully
